pipeline {
    
    agent {
     docker {
       image 'ashi1210/cloudTest-image:vi'
       args '--user root -v /var/run/docker.sock:/var/run/docker.sock'
            }
          }
    
       stages {
        
        stage('Checkout'){
           steps {
                git credentialsId: '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', 
                url: 'https://github.com/ashishdevlopjava/cloudtest.git',
                branch: 'master'
           }
        }
 stage('SonarQube Analysis') {
         environment {
           SONAR_URL = "http://13.233.247.118:9000/"
           SONAR_AUTH_TOKEN = "sqa_4d1f0a96fc4ee08b14daaf67aac890f3d6e890e8"
           }
           steps{
             withCredentials([string(credentialId:'sonarqube', variable: 'SONAR_AUTH_TOKEN')]){

               sh 'mvn sonar:sonar -Dsonar.login=${SONAR_AUTH_TOKEN}       
                   -Dsonar.host.url=${SONAR_URL}'
               
                 }
               }
             }

        stage('Build Docker'){
         environment{
          DOCKER_IMAGE = "ashi1210/cloudtest"
          REGISTRY_CREDENTIALS = 'babulal1210'  
         }
        }
            steps{
                script{
                    sh 'docker build -t ${DOCKER_IMAGE}'
                     docker.withRegistry('https://index.docker.io/v1,"babulal120"'){
                     dockerImage.push()  
                    }
                   
                }
            }
        }
        
               
     }
}
